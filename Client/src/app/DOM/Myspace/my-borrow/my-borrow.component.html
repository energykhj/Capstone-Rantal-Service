<div class="container mt-3">
  <div class="d-flex flex-row flex-wrap">
    <div class="col-md-9 p-0 mb-3">
      <div class="card item-card shadow-sm bg-white m-1">
        <div class="card-header">
          <h3>My Borrows</h3>
        </div>
        <div class="card-body">
          <ul
            ngbNav
            #nav="ngbNav"
            [(activeId)]="active"
            [destroyOnHide]="false"
            (navChange)="onNavChange()"
            class="nav-tabs"
          >
            <!-- Borrowing list Start -->
            <li [ngbNavItem]="0">
              <a ngbNavLink>Requested</a>
              <ng-template ngbNavContent>
                <div class="input-group mt-3 mb-3">
                  <input
                    [(ngModel)]="NameFilter"
                    class="form-control"
                    style="background-color: rgb(252, 248, 251); border-color: rgb(218, 216, 216)"
                    (keyup)="Filter(0)"
                    placeholder="Filter by Name"
                  />
                  <div class="input-group-append">
                    <span class="input-group-text" id="basic-addon2"> <i class="fa fa-search fa-xs"></i></span>
                  </div>
                </div>

                <div class="row mb-3" *ngFor="let requestItemPkg of filteredRequestItemPkgs">
                  <div class="col-md-12">
                    <div class="card">
                      <div class="card-body">
                        <div class="row">
                          <div class="col-md-3">
                            <!-- <img src="{{ requestItemPkg.item.defaultImageFile}}" /> -->
                            <img [src]="requestItemPkg.item.defaultImageFile | authImg | async" />
                          </div>
                          <div class="borrow col-md-6">
                            <h4 mb-3>{{ requestItemPkg.item.name }}</h4>
                            <h4 class="title">
                              Borrow from
                              <a class="text-primary" (click)="openOwnerDetails(requestItemPkg.item.userId)">{{
                                ownerNames[requestItemPkg.item.userId]
                              }}</a>
                            </h4>
                            <h4 class="date" mb-2>Borrow date: {{ formatDate(requestItemPkg.trans.startDate) }}</h4>
                            <h4>
                              <span class="when">When: </span
                              ><span class="text-primary"
                                >{{ formatDate(requestItemPkg.trans.startDate) }} ~
                                {{ formatDate(requestItemPkg.trans.endDate) }}</span
                              >
                            </h4>
                          </div>
                          <div class="col-md-3">
                            <small> <span>Deposit: </span>{{ formatCurrency(requestItemPkg.trans.deposit) }} </small
                            ><br class="mb-1" />
                            <p>
                              <small><span>Total Fee: </span>{{ formatCurrency(requestItemPkg.trans.total) }}</small>
                            </p>
                            <p class="text-danger">{{ statusText[requestItemPkg.trans.currentStatus] }}</p>

                            <!-- {{ requestItemPkg.trans.statusName }} -->
                            <button mat-stroked-button (click)="onCancelRequest(requestItemPkg.trans.id)" color="warn">
                              Cancel Request
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div *ngIf="notEmptyPost" class="col-md-12 d-flex justify-content-center">
                  <button (click)="onClick()" type="button" class="btn btn-secondary">LOAD MORE</button>
                </div>
              </ng-template>
            </li>
            <!-- Borrowing List End -->

            <!-- Borrowing list Start -->
            <li [ngbNavItem]="1">
              <a ngbNavLink>Borrowing</a>
              <ng-template ngbNavContent>
                <div class="input-group mt-3 mb-3">
                  <input
                    [(ngModel)]="NameFilter"
                    class="form-control"
                    style="background-color: rgb(252, 248, 251); border-color: rgb(218, 216, 216)"
                    (keyup)="Filter(1)"
                    placeholder="Filter by Name"
                  />
                  <div class="input-group-append">
                    <span class="input-group-text" id="basic-addon2"> <i class="fa fa-search fa-xs"></i></span>
                  </div>
                </div>

                <div class="row mb-3" *ngFor="let borrowingItemPkg of filteredBorrowingItemPkgs">
                  <div class="col-md-12">
                    <div class="card">
                      <div class="card-body">
                        <div class="row">
                          <div class="col-md-3">
                            <!-- <img src="{{ borrowingItemPkg.item.defaultImageFile }}" /> -->
                            <img [src]="borrowingItemPkg.item.defaultImageFile | authImg | async" />
                          </div>
                          <div class="borrow col-md-6">
                            <h4 mb-2>{{ borrowingItemPkg.item.name }}</h4>
                            <h4 class="title">
                              Borrow from
                              <a class="text-primary" (click)="openOwnerDetails(borrowingItemPkg.item.userId)">{{
                                ownerNames[borrowingItemPkg.item.userId]
                              }}</a>
                            </h4>
                            <h4 class="date" mb-3>Borrow date: {{ formatDate(borrowingItemPkg.trans.startDate) }}</h4>
                            <h4>
                              <span class="when">When: </span
                              ><span class="text-primary"
                                >{{ formatDate(borrowingItemPkg.trans.startDate) }} ~
                                {{ formatDate(borrowingItemPkg.trans.endDate) }}</span
                              >
                            </h4>
                            <h4 class="returnby">
                              Return by: {{ formatDate(borrowingItemPkg.trans.endDate) }}
                              <span *ngIf="dateDiffInDays(currentDate, borrowingItemPkg.trans.endDate) == 0"
                                >(today)
                              </span>
                              <span *ngIf="dateDiffInDays(currentDate, borrowingItemPkg.trans.endDate) < 0"
                                >(over)
                              </span>
                              <span *ngIf="dateDiffInDays(currentDate, borrowingItemPkg.trans.endDate) > 0"
                                >({{ dateDiffInDays(borrowingItemPkg.trans.endDate, currentDate) }})
                              </span>
                            </h4>
                          </div>
                          <div class="col-md-3">
                            <small> <span>Deposit: </span>{{ formatCurrency(borrowingItemPkg.trans.deposit) }} </small
                            ><br class="mb-1" />
                            <p>
                              <small><span>Total Fee: </span>{{ formatCurrency(borrowingItemPkg.trans.total) }}</small>
                            </p>
                            <p class="text-danger">{{ statusText[borrowingItemPkg.trans.currentStatus] }}</p>

                            <button
                              *ngIf="!checkRequestReturn(borrowingItemPkg.trans.currentStatus)"
                              mat-stroked-button
                              (click)="onRequestReturn(borrowingItemPkg.trans.id)"
                              color="primary"
                            >
                              Request Return
                            </button>
                            <button
                              *ngIf="!checkRequestReturn(borrowingItemPkg.trans.currentStatus)"
                              mat-stroked-button
                              (click)="onCancelReservation(borrowingItemPkg.trans.id)"
                              color="warn"
                            >
                              Cancel Borrow
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div *ngIf="notEmptyPost" class="col-md-12 d-flex justify-content-center">
                  <button (click)="onClick()" type="button" class="btn btn-secondary">LOAD MORE</button>
                </div>
              </ng-template>
            </li>
            <!-- Borrowing List End -->

            <!-- completed Start -->
            <li [ngbNavItem]="2">
              <a ngbNavLink>Completed</a>
              <ng-template ngbNavContent>
                <div class="input-group mt-3 mb-3">
                  <input
                    [(ngModel)]="NameFilter"
                    class="form-control"
                    style="background-color: rgb(252, 248, 251); border-color: rgb(218, 216, 216)"
                    (keyup)="Filter(2)"
                    placeholder="Filter by Name"
                  />
                  <div class="input-group-append">
                    <span class="input-group-text" id="basic-addon2"> <i class="fa fa-search fa-xs"></i></span>
                  </div>
                </div>

                <div class="row mb-3" *ngFor="let compledtedItemPkg of filteredCompledtedItemPkgs">
                  <div class="col-md-12">
                    <div class="card">
                      <div class="card-body">
                        <div class="row">
                          <div class="col-md-3">
                            <!-- <img src="{{ compledtedItemPkg.item.defaultImageFile }}" /> -->
                            <img [src]="compledtedItemPkg.item.defaultImageFile | authImg | async" />
                          </div>
                          <div class="borrow col-md-6">
                            <h4 mb-3>{{ compledtedItemPkg.item.name }}</h4>
                            <h4 class="title">
                              Borrow from
                              <a class="text-primary" (click)="openOwnerDetails(compledtedItemPkg.item.userId)">{{
                                ownerNames[compledtedItemPkg.item.userId]
                              }}</a>
                            </h4>
                            <h4 class="date" mb-3>Borrow date: {{ formatDate(compledtedItemPkg.trans.startDate) }}</h4>
                            <h4>
                              <span class="when">When: </span
                              ><span class="text-primary"
                                >{{ formatDate(compledtedItemPkg.trans.startDate) }} ~
                                {{ formatDate(compledtedItemPkg.trans.endDate) }}</span
                              >
                            </h4>
                          </div>
                          <div class="col-md-3">
                            <small> <span>Deposit: </span>{{ formatCurrency(compledtedItemPkg.trans.deposit) }} </small
                            ><br class="mb-1" />
                            <p>
                              <small><span>Total Fee: </span>{{ formatCurrency(compledtedItemPkg.trans.total) }}</small>
                            </p>
                            <p class="text-danger">{{ statusText[compledtedItemPkg.trans.currentStatus] }}</p>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </ng-template>
            </li>
            <!-- completed End -->

            <li ngbNavItem class="ml-auto">
              <a ngbNavLink routerLink="/my-list">My Items</a>
            </li>
          </ul>

          <div [ngbNavOutlet]="nav" class="mt-2"></div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="row mb-3">
        <div class="col-md-12">
          <div class="card">
            <div class="card-body">
              <strong>
                <p>Notification</p>
              </strong>
              <ul class="list-unstyled">
                <a href="#">
                  <li>Reject</li>
                </a>
                <a href="#">
                  <li>Confirmed from Allison</li>
                </a>
                <a href="#">
                  <li>Digital Accuracy</li>
                </a>
                <a href="#">
                  <li>Digital Accuracy</li>
                </a>
                <a href="#">
                  <li>Digital Accuracy</li>
                </a>
                <a href="#">
                  <li>Digital Accuracy</li>
                </a>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <div class="row mb-3">
        <div class="col-md-12">
          <div class="card">
            <div class="card-body">
              <button type="button" class="btn btn-outline bg-orange btn-block">Contat Now</button>
            </div>
          </div>
        </div>
      </div>
      <div class="row mb-3">
        <div class="col-md-12">
          <div class="card">
            <div class="card-body">
              <button type="button" class="btn btn-outline bg-orange btn-block">Contat Now</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
